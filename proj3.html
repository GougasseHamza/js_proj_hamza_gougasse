<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Quiz QCM - Open Trivia</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      background: #f0f0f0;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 700px;
      margin: 30px auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1, h2 {
      text-align: center;
      margin: 0 0 20px 0;
      color: #3498db;
    }
    
    #config-form {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 20px;
    }
    label {
      font-weight: 600;
      margin-bottom: 5px;
    }
    select, button {
      padding: 10px;
      font-size: 1rem;
      border-radius: 5px;
      border: 1px solid #ccc;
      outline: none;
      width: 100%;
    }
    button {
      background: #3498db;
      color: #fff;
      cursor: pointer;
      border: none;
      transition: background 0.3s;
    }
    button:hover {
      background: #2980b9;
    }
    
    .score-timer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 0 10px;
      font-size: 1.2em;
    }
    .score {
      font-weight: 600;
      color: #2ecc71;
    }
    .timer {
      font-weight: 600;
      color: #e74c3c;
    }
    
    #quiz-container {
      display: none;
    }
    .question-container {
      margin-bottom: 20px;
    }
    .question-text {
      font-size: 1.2em;
      margin-bottom: 15px;
    }
    .options {
      list-style: none;
      padding: 0;
    }
    .options li {
      margin: 10px 0;
    }
    .options li label {
      display: block;
      padding: 10px;
      background: #ecf0f1;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .options li label:hover {
      background: #d0d7de;
    }
    .btn {
      display: block;
      width: 100%;
      padding: 10px;
      background: #3498db;
      color: #fff;
      border: none;
      border-radius: 5px;
      font-size: 1.1em;
      cursor: pointer;
      margin-top: 20px;
      transition: background 0.3s;
    }
    .btn:hover {
      background: #2980b9;
    }
   
    #result-container {
      display: none;
      text-align: center;
    }
    #result-container p {
      font-size: 1.2em;
    }
  </style>
</head>
<body>

<div class="container">
  <h1>API Helper</h1>

  <form id="config-form">
    
    <div>
      <label for="numQuestions">Number of Questions:</label>
      <select id="numQuestions">
        <option value="5">5</option>
        <option value="10" selected>10</option>
        <option value="15">15</option>
        <option value="20">20</option>
      </select>
    </div>
    
    <div>
      <label for="category">Select Category:</label>
      <select id="category">
        <option value="">Any Category</option>
        <option value="9">General Knowledge</option>
        <option value="10">Entertainment: Books</option>
        <option value="11">Entertainment: Film</option>
        <option value="12">Entertainment: Music</option>
        <option value="13">Entertainment: Musicals &amp; Theatres</option>
        <option value="14">Entertainment: Television</option>
        <option value="15">Entertainment: Video Games</option>
        <option value="16">Entertainment: Board Games</option>
        <option value="17">Science &amp; Nature</option>
        <option value="18">Science: Computers</option>
        <option value="19">Science: Mathematics</option>
        <option value="20">Mythology</option>
        
      </select>
    </div>
  
    <div>
      <label for="difficulty">Select Difficulty:</label>
      <select id="difficulty">
        <option value="">Any Difficulty</option>
        <option value="easy">Easy</option>
        <option value="medium">Medium</option>
        <option value="hard">Hard</option>
      </select>
    </div>
  
    <div>
      <label for="type">Select Type:</label>
      <select id="type">
        <option value="">Any Type</option>
        <option value="multiple">Multiple Choice</option>
        <option value="boolean">True / False</option>
      </select>
    </div>
    
    <div>
      <label for="encoding">Select Encoding:</label>
      <select id="encoding">
        <option value="default">Default Encoding</option>
        <option value="urlLegacy">Legacy URL Encoding</option>
        <option value="url3986">URL Encoding (RFC 3986)</option>
        <option value="base64">Base64 Encoding</option>
      </select>
    </div>
   
    <button type="submit">GENERATE API URL</button>
  </form>

  <div id="quiz-container">
    <h2>Quiz</h2>
    <div class="score-timer">
      <div id="score" class="score">Score: 0</div>
      <div id="timer" class="timer">Temps: 20s</div>
    </div>
    <div id="question-area"></div>
  </div>


  <div id="result-container">
    <h2>RÃ©sultat</h2>
    <p id="final-score"></p>
    <button id="restart-btn" class="btn">Recommencer</button>
  </div>
</div>

<script>
    
    const config_form = document.getElementById('config-form');
    const quiz_container = document.getElementById('quiz-container');
    const result_container = document.getElementById('result-container');
    const question_area = document.getElementById('question-area');
    const score_display = document.getElementById('score');
    const timer_display = document.getElementById('timer');
    const final_score_display = document.getElementById('final-score');
    const restart_btn = document.getElementById('restart-btn');
  
    
    let start= 0 ; 
    let questions = [];
    let current_question_index = 0;
    let score_val = 0;
    let timer_interval;
    const time_per_question = 20;
    let time_left = time_per_question;

    config_form.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      // console.log("ok") ;
      let num_questions = document.getElementById('numQuestions').value;
      let category_val = document.getElementById('category').value;
      let difficulty_val = document.getElementById('difficulty').value;
      let type_val = document.getElementById('type').value;
      let encoding_val = document.getElementById('encoding').value;
  
      let api_url = `https://opentdb.com/api.php?amount=${num_questions}`;
      if (category_val)   api_url += `&category=${category_val}`;
      if (difficulty_val) api_url += `&difficulty=${difficulty_val}`;
      if (type_val)       api_url += `&type=${type_val}`;
      
      if (encoding_val && encoding_val !== 'default') {
        if (encoding_val === 'urlLegacy') {
          api_url += '&encode=urlLegacy';
        } else if (encoding_val === 'url3986') {
          api_url += '&encode=url3986';
        } else if (encoding_val === 'base64') {
          api_url += '&encode=base64';
        }
      }

      // sir tqlb 
      let response = await fetch(api_url);
      let data = await response.json();
      questions = data.results;
      
      // reset quiz
      score_val = 0;
      current_question_index = 0;
      score_display.textContent = 'Score: 0';
  
      
      config_form.style.display = 'none';
      quiz_container.style.display = 'block';
      result_container.style.display = 'none';
  
     
      display_question();
    });
  
    // go next qst 
    function display_question() {
      clearInterval(timer_interval);
      time_left = time_per_question;
      timer_display.textContent = 'Temps: ' + time_left + 's';
      start_timer();
      
      if (current_question_index < questions.length) {
        let current_q = questions[current_question_index];
        let question_text = decode_html_entities(current_q.question);
  
        let answers = [...current_q.incorrect_answers, current_q.correct_answer];
        shuffle_array(answers);
  
        let html_content = '<div class="question-container"><div class="question-text">' + question_text + '</div><ul class="options">';
        answers.forEach(function(ans) {
          html_content += '<li><label><input type="radio" name="option" value="' + ans + '" /> ' + decode_html_entities(ans) + '</label></li>';
        });
        html_content += '</ul><button class="btn" id="next-btn">Suivant</button></div>';
  
        question_area.innerHTML = html_content;
        document.getElementById('next-btn').addEventListener('click', next_question);
      } else {
        display_result();
      }
    }
  
    // lwqt
    function start_timer() {
        timer_interval = setInterval(function() {
          time_left--;
          timer_display.textContent = 'Temps: ' + time_left + 's';
      
          if (time_left > 10) {
            timer_display.style.color = 'green';
          } else if (time_left > 5) {
            timer_display.style.color = 'orange';
          } else {
            timer_display.style.color = 'red';
          }
      
          //layshl 
          if (time_left <= 0) {
            clearInterval(timer_interval);
            next_question();
          }
        }, 1000);
      }
      
    // go next qst 
    function next_question() {
      clearInterval(timer_interval);
      let current_q = questions[current_question_index];
      let selected_option = document.querySelector('input[name="option"]:checked');
      if (selected_option && selected_option.value === current_q.correct_answer) {
        score_val++;
        score_display.textContent = 'Score: ' + score_val;
      }
      current_question_index++;
      
      // scroll top
      window.scrollTo({ top: 0, behavior: 'smooth' });
      display_question();
    }
  
    // results
    function display_result() {
      quiz_container.style.display = 'none';
      result_container.style.display = 'block';
      final_score_display.textContent = 'Vous avez obtenu ' + score_val + ' / ' + questions.length + ' points.';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  
    // reset
    restart_btn.addEventListener('click', function() {
      config_form.style.display = 'block';
      quiz_container.style.display = 'none';
      result_container.style.display = 'none';
      config_form.reset();
    });
  
    // shuffle
    function shuffle_array(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1));
        let temp = arr[i];
        arr[i] = arr[j];
        arr[j] = temp;
      }
    }
  
    // need to decode the txt given by api 
    function decode_html_entities(txt) {
      let txt_area = document.createElement('textarea');
      txt_area.innerHTML = txt;
      return txt_area.value;
    }
  </script>
  
</body>
</html>
